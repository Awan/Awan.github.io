<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>Encrypted Arch Linux installation - Abdullah Khabir</title><meta name="Description" content="Encrypted Arch Linux installation"><meta property="og:title" content="Encrypted Arch Linux installation" />
<meta property="og:description" content="Encrypted Arch Linux installation" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://abdullah.today/encrypted-archlinux/" /><meta property="og:image" content="https://abdullah.today/logo.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-01-03T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-01-03T00:00:00+00:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://abdullah.today/logo.png"/>

<meta name="twitter:title" content="Encrypted Arch Linux installation"/>
<meta name="twitter:description" content="Encrypted Arch Linux installation"/>
<meta name="application-name" content="Abdullah Khabir">
<meta name="apple-mobile-web-app-title" content="Abdullah Khabir"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://abdullah.today/encrypted-archlinux/" /><link rel="prev" href="https://abdullah.today/polybar/" /><link rel="next" href="https://abdullah.today/encrypted-dotfiles/" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Encrypted Arch Linux installation",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/abdullah.today\/encrypted-archlinux\/"
        },"image": ["https:\/\/abdullah.today\/images\/Apple-Devices-Preview.png"],"genre": "posts","keywords": "archlinux, encryption, encrypted install, luks, lvm, luks_on_lvm","wordcount":  1115 ,
        "url": "https:\/\/abdullah.today\/encrypted-archlinux\/","datePublished": "2020-01-03T00:00:00+00:00","dateModified": "2020-01-03T00:00:00+00:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "Abdullah Khabir","logo": "https:\/\/abdullah.today\/images\/avatar.png"},"author": {
                "@type": "Person",
                "name": "Abdullah Khabir"
            },"description": "Encrypted Arch Linux installation"
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Abdullah Khabir"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span>Allah is the Greatest!</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/" title="Some reminders"> InfoSec </a><a class="menu-item" href="/quran/"> Quran </a><a class="menu-item" href="/about/"> About </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Start typing to search..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Abdullah Khabir"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span>Allah is the Greatest!</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Start typing to search..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="Some reminders">InfoSec</a><a class="menu-item" href="/quran/" title="">Quran</a><a class="menu-item" href="/about/" title="">About</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><script data-ad-client="ca-pub-6819322586059940" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">Encrypted Arch Linux installation</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://abdullah.today" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw"></i>Abdullah Khabir</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2020-01-03">2020-01-03</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;1115 words&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;6 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#installation">Installation</a></li>
        <li><a href="#installation-media-creation">Installation media creation</a></li>
        <li><a href="#boot-the-media">Boot the media</a></li>
        <li><a href="#connect-to-internet">Connect to internet</a></li>
        <li><a href="#partitioning">Partitioning</a></li>
        <li><a href="#create-file-systems">Create file systems</a></li>
        <li><a href="#install-the-base-system">Install the base system</a></li>
        <li><a href="#generate-fstab">Generate fstab</a></li>
        <li><a href="#chroot-into-new-system">chroot into new system.</a></li>
        <li><a href="#mkinitcpio-configuration">mkinitcpio configuration</a></li>
        <li><a href="#install-bootloader">Install bootloader</a></li>
        <li><a href="#un-mount-and-reboot">Un-mount and reboot</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h1 id="whats-arch-linux">What&rsquo;s <strong>Arch Linux</strong>?</h1>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/arch.jpg"
        data-srcset="/images/arch.jpg, /images/arch.jpg 1.5x, /images/arch.jpg 2x"
        data-sizes="auto"
        alt="/images/arch.jpg"
        title="Arch Linux" /></p>
<p><a href="https://archlinux.org" target="_blank" rel="noopener noreffer">Arch Linux</a> is a free
and open source linux distribution based on the rule Keep it Simple.</p>
<h3 id="installation">Installation</h3>
<p>Arch Linux has no graphical installer. You have to install using CLI.</p>
<h3 id="installation-media-creation">Installation media creation</h3>
<p>Go to <a href="https://archlinux.org/download" target="_blank" rel="noopener noreffer">Downloads page</a> and select a nearby mirror. Download the iso file. If you&rsquo;re on Windows, you can use rufus to create a bootable media.</p>
<p>On linux, you can use <strong>dd</strong>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">dd <span class="k">if</span><span class="o">=</span>downloaded iso file <span class="nv">of</span><span class="o">=</span>/dev/sdX <span class="nv">status</span><span class="o">=</span>progress
</code></pre></td></tr></table>
</div>
</div><p>where X is your USB device&rsquo;s ID. Don&rsquo;t use a single partition. Use the whole
device.</p>
<h3 id="boot-the-media">Boot the media</h3>
<p>Insert the USB device and reboot the computer. Press the button configured to
come boot options up. Choose your USB device from boot options.</p>
<h3 id="connect-to-internet">Connect to internet</h3>
<p>If you have ethernet, Arch linux iso will detect it. If you have a wireless
connection, you have to connect it manually.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">wpa_passphrase <span class="s1">&#39;wifi APN&#39;</span> <span class="s1">&#39;wifi password&#39;</span> &gt;&gt; /etc/wpa_supplicant/wpa_supplicant.conf
wpa_supplicant -Bc /etc/wpa_supplicant/wpa_supplicant.conf -i <span class="s1">&#39;wifi interface&#39;</span>
dhclient
</code></pre></td></tr></table>
</div>
</div><p>where wifi APN is the access point name you get when you scan for your wifi. And
wifi interface you can get using iwconfig. It might be wlp3s0 or wlan0.
Or you can use wifi-menu.</p>
<p>Now ping some website <strong>abdullah.today</strong> to check if you&rsquo;re connected to
internet or not.</p>
<h3 id="partitioning">Partitioning</h3>
<p>There are multiple ways to encrypt the installation. One of them in LUKS on lvm.
It&rsquo;s straightforward.</p>
<p>Assuming you have a UEFI system and sda is your drive where you wanna install
archlinux.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">gdisk /dev/sda
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">GPT fdisk <span class="o">(</span>gdisk<span class="o">)</span> version 1.0.1

  Partition table scan:
  MBR: protective
  BSD: not present
  APM: not present
  GPT: present

Found valid GPT with protective MBR<span class="p">;</span> using GPT.

Command <span class="o">(</span>? <span class="k">for</span> <span class="nb">help</span><span class="o">)</span>: o
This option deletes all partitions and creates a new protective MBR.
Proceed? <span class="o">(</span>Y/N<span class="o">)</span>: Y

Command <span class="o">(</span>? <span class="k">for</span> <span class="nb">help</span><span class="o">)</span>: n
Partition number <span class="o">(</span>1-128, default 1<span class="o">)</span>: 
First sector <span class="o">(</span>34-242187466, <span class="nv">default</span> <span class="o">=</span> 2048<span class="o">)</span> or <span class="o">{</span>+-<span class="o">}</span>size<span class="o">{</span>KMGTP<span class="o">}</span>: 
Last sector <span class="o">(</span>2048-242187466, <span class="nv">default</span> <span class="o">=</span> 242187466<span class="o">)</span> or <span class="o">{</span>+-<span class="o">}</span>size<span class="o">{</span>KMGTP<span class="o">}</span>:
+512M
Current <span class="nb">type</span> is <span class="s1">&#39;Linux filesystem&#39;</span>
Hex code or GUID <span class="o">(</span>L to show codes, <span class="nv">Enter</span> <span class="o">=</span> 8300<span class="o">)</span>: EF00
Changed <span class="nb">type</span> of partition to <span class="s1">&#39;EFI System&#39;</span>

Command <span class="o">(</span>? <span class="k">for</span> <span class="nb">help</span><span class="o">)</span>: n
Partition number <span class="o">(</span>2-128, default 2<span class="o">)</span>: 
First sector <span class="o">(</span>34-242187466, <span class="nv">default</span> <span class="o">=</span> 1050624<span class="o">)</span> or <span class="o">{</span>+-<span class="o">}</span>size<span class="o">{</span>KMGTP<span class="o">}</span>: 
Last sector <span class="o">(</span>1050624-242187466, <span class="nv">default</span> <span class="o">=</span> 242187466<span class="o">)</span> or <span class="o">{</span>+-<span class="o">}</span>size<span class="o">{</span>KMGTP<span class="o">}</span>: 
Current <span class="nb">type</span> is <span class="s1">&#39;Linux filesystem&#39;</span>
Hex code or GUID <span class="o">(</span>L to show codes, <span class="nv">Enter</span> <span class="o">=</span> 8300<span class="o">)</span>: <span class="m">8309</span>
Changed <span class="nb">type</span> of partition to <span class="s1">&#39;Linux LUKS&#39;</span>

Command <span class="o">(</span>? <span class="k">for</span> <span class="nb">help</span><span class="o">)</span>: p
Disk /dev/sda: <span class="m">242187500</span> sectors, 115.5 GiB
Logical sector size: <span class="m">512</span> bytes
Disk identifier <span class="o">(</span>GUID<span class="o">)</span>: 569FFB67-6969-49E4-B999-15A681987564
Partition table holds up to <span class="m">128</span> entries
First usable sector is 34, last usable sector is <span class="m">242187466</span>
Partitions will be aligned on 2048-sector boundaries
Total free space is <span class="m">2014</span> sectors <span class="o">(</span>1007.0 KiB<span class="o">)</span>

Number  Start <span class="o">(</span>sector<span class="o">)</span>    End <span class="o">(</span>sector<span class="o">)</span>  Size       Code  Name
   <span class="m">1</span>            <span class="m">2048</span>         <span class="m">1050623</span>   512.0 MiB   EF00  EFI System
   <span class="m">2</span>         <span class="m">1050624</span>       <span class="m">242187466</span>   115.0 GiB   <span class="m">8309</span>  Linux LUKS

<span class="nb">command</span> <span class="o">(</span>? <span class="k">for</span> <span class="nb">help</span><span class="o">)</span>: w

</code></pre></td></tr></table>
</div>
</div><p>Type o and then Y.</p>
<p>Type n to create a new partition. Select 1 to create a very first partition for
EFI. Hit enter and then type +512M to create a 512 Mbs partition. Enter ef00 as
partition type.</p>
<p>Again type n to create a new partition. Select 2. Hit enter and again enter to
give it rest of the storage if you don&rsquo;t wanna install some other operating
system. Hex code for LUKS is 8309 but you can go without it. By default it will
be 8300 (linux filesystem).</p>
<p>Type p to check if everything is fine. And once satisfied, type w and hit enter
to save the work.</p>
<h3 id="create-file-systems">Create file systems</h3>
<p>First, create a filesystem for EFI.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">mkfs.vfat -F32 /dev/sda1
</code></pre></td></tr></table>
</div>
</div><p>Now create a LUKS container.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"> cryptsetup luksFormat /dev/sda2
</code></pre></td></tr></table>
</div>
</div><p>It will ask you to confirm. Type YES in all uppercase. Then choose a good
passphrase. Write it if you can&rsquo;t memorize it. Once forgotten, you can&rsquo;t recover
it.</p>
<p>Now open the new container.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"> cryptsetup open /dev/sda2 cryptlvm
</code></pre></td></tr></table>
</div>
</div><p>Create a physical volume in this LUKS container.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"> pvcreate /dev/mapper/cryptlvm
</code></pre></td></tr></table>
</div>
</div><p>Create a volume group. I&rsquo;ll name it nix.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"> vgcreate nix /dev/mapper/cryptlvm
</code></pre></td></tr></table>
</div>
</div><p>Create logical volumes on volume group. I&rsquo;m creating three, one for encrypted swap
and another for home and last one for root.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"> lvcreate -L 8G nix -n swap
 lvcreate -L 25G nix -n root
 lvcreate -l +100%FREE nix -n home
</code></pre></td></tr></table>
</div>
</div><p>Now create filesystems.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"> mkfs.ext4 /dev/mapper/nix-root
 mkfs.ext4 /dev/mapper/nix-home
 mkswap /dev/mapper/nix-swap
</code></pre></td></tr></table>
</div>
</div><p>Mount them.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"> mount /dev/mapper/nix-root /mnt
 mkdir /mnt/home
 mkdir /mnt/boot
 mount /dev/mapper/nix-home /mnt/home
 mount /dev/sda1 /mnt/boot
</code></pre></td></tr></table>
</div>
</div><p>Turn the swap partition on.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"> swapon /dev/mapper/nix-swap
</code></pre></td></tr></table>
</div>
</div><h3 id="install-the-base-system">Install the base system</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"> pacstrap /mnt base base-devel linux linux-firmware
</code></pre></td></tr></table>
</div>
</div><h3 id="generate-fstab">Generate fstab</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"> genfstab -U /mnt &gt;&gt; /mnt/etc/fstab
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p><strong><em>NOTE:</em></strong> If you&rsquo;re using an SSD, replace relatime with noatime in  /mnt/etc/fstab except boot partition.</p>
</blockquote>
<h3 id="chroot-into-new-system">chroot into new system.</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"> arch-chroot /mnt
</code></pre></td></tr></table>
</div>
</div><p>Set the timezone.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"> ln -s /usr/share/zoneinfo/Asia/Karachi /etc/localtime
 hwclock --systohc
</code></pre></td></tr></table>
</div>
</div><p>Replace Asia with your continent and Karachi with city.</p>
<p>Set hostname</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"> <span class="nb">echo</span> nix &gt; /etc/hostname
</code></pre></td></tr></table>
</div>
</div><p>Replace nix with name you wanna give your machine to.</p>
<p>Set locales</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"> vim /etc/locale.gen

  <span class="c1">#en_HK ISO-8859-1  </span>
  <span class="c1">#en_IE.UTF-8 UTF-8  </span>
  <span class="c1">#en_IE ISO-8859-1  </span>
  <span class="c1">#en_IE@euro ISO-8859-15  </span>
  <span class="c1">#en_IL UTF-8  </span>
  <span class="c1">#en_IN UTF-8  </span>
  <span class="c1">#en_NG UTF-8  </span>
  <span class="c1">#en_NZ.UTF-8 UTF-8  </span>
  <span class="c1">#en_NZ ISO-8859-1  </span>
  <span class="c1">#en_PH.UTF-8 UTF-8  </span>
  <span class="c1">#en_PH ISO-8859-1  </span>
  <span class="c1">#en_SC.UTF-8 UTF-8  </span>
  <span class="c1">#en_SG.UTF-8 UTF-8  </span>
  <span class="c1">#en_SG ISO-8859-1  </span>
  en_US.UTF-8 UTF-8  
  <span class="c1">#en_US ISO-8859-1  </span>
  <span class="c1">#en_ZA.UTF-8 UTF-8  </span>
  <span class="c1">#en_ZA ISO-8859-1  </span>
  <span class="c1">#en_ZM UTF-8  </span>
  <span class="c1">#en_ZW.UTF-8 UTF-8  </span>
  <span class="c1">#en_ZW ISO-8859-1  </span>
  <span class="c1">#eo UTF-8  </span>
  <span class="c1">#es_AR.UTF-8 UTF-8  </span>
  <span class="c1">#es_AR ISO-8859-1  </span>
  <span class="c1">#es_BO.UTF-8 UTF-8  </span>
</code></pre></td></tr></table>
</div>
</div><p>Uncomment en_US.UTF-8 UTF-8 . (remove # from the beginning)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"> <span class="nb">echo</span> <span class="nv">LANG</span><span class="o">=</span>en_US.UTF-8 &gt; /etc/locale.conf
 locale-gen
</code></pre></td></tr></table>
</div>
</div><p>Install some necessary software.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"> pacman -S wpa_supplicant dhclient dialog
</code></pre></td></tr></table>
</div>
</div><p>Create a user.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"> useradd -m -G wheel <span class="s1">&#39;username&#39;</span>
 passwd <span class="s1">&#39;username&#39;</span>
</code></pre></td></tr></table>
</div>
</div><p>Create root password</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"> passwd
</code></pre></td></tr></table>
</div>
</div><h3 id="mkinitcpio-configuration">mkinitcpio configuration</h3>
<p>Edit the file <strong>/etc/mkinitcpio.conf</strong>. Copy this line or write in order in hooks line. Order matters so don&rsquo;t ignore or you will get un-bootable system.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"> vim /etc/mkinitcpio.conf

<span class="nv">HOOKS</span><span class="o">=(</span>base udev autodetect keyboard keymap consolefont modconf block encrypt lvm2 filesystems resume fsck<span class="o">)</span>

</code></pre></td></tr></table>
</div>
</div><p>Generate mkinitcpio</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">mkinitcpio -p linux
</code></pre></td></tr></table>
</div>
</div><h3 id="install-bootloader">Install bootloader</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"> bootctl install 
</code></pre></td></tr></table>
</div>
</div><p>Create entries.</p>
<p>Create a file <strong>/boot/loader/entries/arch.conf</strong>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"> vim /boot/loader/entries/arch.conf

title	ArchLinux
linux	/vmlinuz-linux
initrd	/initramfs-linux.img
options <span class="nv">cryptdevice</span><span class="o">=</span><span class="nv">UUID</span><span class="o">=</span>&lt;YOUR-PARTITION-UUID&gt;:lvm:allow-discards <span class="nv">resume</span><span class="o">=</span>/dev/mapper/nix-swap <span class="nv">root</span><span class="o">=</span>/dev/mapper/nix-root rw quiet

</code></pre></td></tr></table>
</div>
</div><p>Where UUID you can get using blkid. It would be in /dev/sda2.</p>
<h3 id="un-mount-and-reboot">Un-mount and reboot</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"> <span class="nb">exit</span>
 umount /mnt
 reboot
</code></pre></td></tr></table>
</div>
</div><p>Remove the USB device. And enjoy your new archlinux encrypted installation.</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2020-01-03</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://abdullah.today/encrypted-archlinux/" data-title="Encrypted Arch Linux installation" data-via="AbdullahToday" data-hashtags="archlinux,encryption,encrypted install,luks,lvm,luks_on_lvm"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://abdullah.today/encrypted-archlinux/" data-hashtag="archlinux"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="https://abdullah.today/encrypted-archlinux/" data-title="Encrypted Arch Linux installation"><i class="fab fa-hacker-news fa-fw"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="https://abdullah.today/encrypted-archlinux/" data-title="Encrypted Arch Linux installation"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@2.14.0/icons/line.svg"></i></a><a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="https://abdullah.today/encrypted-archlinux/" data-title="Encrypted Arch Linux installation"><i class="fab fa-weibo fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/archlinux/">archlinux</a>,&nbsp;<a href="/tags/encryption/">encryption</a>,&nbsp;<a href="/tags/encrypted-install/">encrypted install</a>,&nbsp;<a href="/tags/luks/">luks</a>,&nbsp;<a href="/tags/lvm/">lvm</a>,&nbsp;<a href="/tags/luks_on_lvm/">luks_on_lvm</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/polybar/" class="prev" rel="prev" title="Polybar - A stylish bar"><i class="fas fa-angle-left fa-fw"></i>Polybar - A stylish bar</a>
            <a href="/encrypted-dotfiles/" class="next" rel="next" title="Encrypted dotfiles with GnuPG">Encrypted dotfiles with GnuPG<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"><div id="fb-root" class="comment"></div>
            <div
                class="fb-comments"
                data-href="https://abdullah.today/encrypted-archlinux/"
                data-width="100%"
                data-numposts="10"
            ></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://developers.facebook.com/docs/plugins/comments/"></a>Facebook</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2019 - 2022</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://abdullah.today" target="_blank">Abdullah Khabir</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><script type="text/javascript" src="https://connect.facebook.net/en_US/sdk.js#xfbml=1&amp;version=v5.0&amp;appId=457812464807680&amp;autoLogAppEvents=1" defer></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/algoliasearch@4.2.0/dist/algoliasearch-lite.umd.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":10},"comment":{},"search":{"algoliaAppID":"3L4LIEJSP4","algoliaIndex":"index-en","algoliaSearchKey":"5d79bed67aeb5ed5e5a990cfad81ebde","highlightTag":"em","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"algolia"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
